@echo off
echo ğŸ”„ DÃ©ploiement Oradia en cours...

REM ğŸ“‚ VÃ©rifier si on est dans un dÃ©pÃ´t Git
git rev-parse --is-inside-work-tree >nul 2>&1
if errorlevel 1 (
    echo âŒ Ce dossier n'est pas un dÃ©pÃ´t Git. Abandon...
    pause
    exit /b
)

REM ğŸ“Œ RÃ©cupÃ¨re la branche courante
for /f %%b in ('git branch --show-current') do set currentBranch=%%b
echo ğŸ“Œ Branche courante : %currentBranch%

REM ğŸš¨ Si pas sur main, on bascule et merge
if NOT "%currentBranch%"=="main" (
    echo ğŸ”„ Changement vers la branche main...
    git checkout main

    echo ğŸ”€ Fusion des changements depuis %currentBranch% dans main...
    git merge %currentBranch%
)

REM âœ… Ajoute tous les fichiers (y compris supprimÃ©s et non trackÃ©s)
git add -A

REM âœ… VÃ©rifie sâ€™il y a des changements Ã  commit
git diff --cached --quiet
if %errorlevel% equ 0 (
    echo âš ï¸ Aucun changement dÃ©tectÃ© Ã  committer.
) else (
    echo ğŸ“ Commit des changements...
    git commit -m "ğŸ”„ DÃ©ploiement Oradia auto"
)

REM ğŸŒ± VÃ©rifie si lâ€™upstream est configurÃ©
git rev-parse --abbrev-ref --symbolic-full-name @{u} >nul 2>&1
if errorlevel 1 (
    echo ğŸŒ± Aucun upstream configurÃ©. CrÃ©ation de lâ€™upstream...
    git push -u origin main
) else (
    REM ğŸš€ Push sur la branche distante
    echo ğŸš€ Push des modifications sur GitHub...
    git push origin main
)

REM ğŸ”„ DÃ©clenche un rebuild Vercel mÃªme sans changement
echo ğŸ”„ DÃ©clenche un rebuild Vercel...
git commit --allow-empty -m "ğŸ”„ Rebuild Vercel"
git push origin main

echo âœ… DÃ©ploiement terminÃ©. VÃ©rifie sur https://oradia.fr
pause
